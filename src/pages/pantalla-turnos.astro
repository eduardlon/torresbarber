---
export const prerender = false;
const {
  PUBLIC_SUPABASE_URL,
  PUBLIC_SUPABASE_ANON_KEY,
  PUBLIC_YOUTUBE_API_KEY,
} = import.meta.env;
// Pantalla moderna para TV con YouTube + Sistema de Turnos
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Turnos en Vivo - JP Barber</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
  <script type="module" src="/src/lib/supabase.ts"></script>
  <style is:global>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background: #000000;
      color: #ffffff;
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* Efectos de fondo estilo HeroBarber */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 15% 25%, rgba(220, 38, 38, 0.15), transparent 50%),
                  radial-gradient(circle at 85% 70%, rgba(185, 28, 28, 0.12), transparent 55%),
                  radial-gradient(circle at 50% 90%, rgba(127, 29, 29, 0.1), transparent 60%);
      filter: blur(100px);
      opacity: 0.6;
      animation: nebula-pulse 20s ease-in-out infinite alternate;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes nebula-pulse {
      0% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
      100% { opacity: 0.6; transform: scale(1.02); }
    }

    /* Stars background */
    .stars-layer {
      position: fixed;
      inset: 0;
      background-image: 
        radial-gradient(3px 3px at 15% 20%, rgba(255,255,255,1), transparent),
        radial-gradient(2px 2px at 25% 45%, rgba(255,255,255,0.95), transparent),
        radial-gradient(3.5px 3.5px at 35% 15%, rgba(220,38,38,1), transparent),
        radial-gradient(1.5px 1.5px at 45% 65%, rgba(255,255,255,0.9), transparent),
        radial-gradient(2.5px 2.5px at 55% 35%, rgba(220,38,38,0.95), transparent),
        radial-gradient(2px 2px at 65% 80%, rgba(255,255,255,0.85), transparent),
        radial-gradient(3px 3px at 75% 25%, rgba(255,255,255,1), transparent),
        radial-gradient(1.5px 1.5px at 85% 55%, rgba(220,38,38,0.9), transparent);
      background-size: 100% 100%;
      pointer-events: none;
      z-index: 0;
      opacity: 0.8;
    }

    .container {
      position: relative;
      z-index: 10;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 1rem 0.75rem;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
      padding: 0.5rem 0.75rem;
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: flex-end;
    }

    .brand {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 1rem;
      margin-bottom: 0.5rem;
    }

    .brand-icon {
      font-size: 2.5rem;
      filter: drop-shadow(0 0 20px rgba(220, 38, 38, 0.8));
    }

    .brand-text {
      font-size: 2.5rem;
      font-weight: 900;
      background: linear-gradient(135deg, #dc2626, #ef4444, #f87171);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 40px rgba(220, 38, 38, 0.5);
      letter-spacing: 3px;
    }

    .subtitle {
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 400;
      letter-spacing: 1.5px;
    }

    .current-time,
    .current-date {
      position: relative;
      font-size: 0.95rem;
      color: rgba(255, 255, 255, 0.85);
      font-weight: 600;
      background: rgba(220, 38, 38, 0.08);
      padding: 0.5rem 1rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(220, 38, 38, 0.25);
      backdrop-filter: blur(10px);
      text-align: right;
      min-width: 180px;
    }

    .current-date {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.7);
    }

    .main-content {
      flex: 1;
      display: grid;
      grid-template-columns: 1.6fr 1fr;
      gap: 1rem;
      min-height: 0; /* Crucial for nested scrolling */
      align-items: stretch;
      padding: 0 0.75rem 0.5rem 0.75rem;
    }

    .youtube-section {
      position: relative;
      background: linear-gradient(135deg, rgba(30, 30, 32, 0.9), rgba(50, 50, 55, 0.8));
      border: 2px solid rgba(220, 38, 38, 0.4);
      border-radius: 1.5rem;
      overflow: hidden;
      backdrop-filter: blur(20px);
      display: flex;
      flex-direction: column;
      height: 100%;
      box-shadow: 
        0 0 60px rgba(220, 38, 38, 0.3),
        0 25px 50px -12px rgba(0, 0, 0, 0.8),
        inset 0 0 0 1px rgba(220, 38, 38, 0.2);
    }

    .youtube-header {
      padding: 0.65rem 1.25rem;
      border-bottom: 1px solid rgba(220, 38, 38, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(220, 38, 38, 0.05);
      flex-shrink: 0;
      height: 55px;
    }

    .youtube-title {
      font-size: 1.2rem;
      font-weight: 800;
      background: linear-gradient(135deg, #dc2626, #ef4444);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .youtube-player-container {
      flex: 1;
      position: relative;
      min-height: 0;
      background: #000;
    }

    .youtube-player {
      width: 100%;
      height: 100%;
      position: relative;
    }

    #ytplayer {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Bot√≥n fullscreen custom - ROJO - SOBRE TODO */
    .custom-fullscreen-btn {
      position: absolute;
      bottom: 1rem;
      right: 1rem;
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, rgba(220, 38, 38, 0.95), rgba(185, 28, 28, 0.9));
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2147483648;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.5);
    }

    .custom-fullscreen-btn:hover {
      background: linear-gradient(135deg, rgba(220, 38, 38, 1), rgba(185, 28, 28, 1));
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(220, 38, 38, 0.7);
    }

    .custom-fullscreen-btn:active {
      transform: scale(0.95);
    }

    /* Reposicionar bot√≥n cuando est√° en fullscreen */
    .youtube-player-container:fullscreen .custom-fullscreen-btn,
    .youtube-player-container:-webkit-full-screen .custom-fullscreen-btn,
    .youtube-player-container:-moz-full-screen .custom-fullscreen-btn {
      bottom: 1rem;
      right: 1rem;
      z-index: 2147483648;
    }

    .youtube-tabs {
      display: none; /* Ocultar tabs para ahorrar espacio en TV */
    }

    .queue-section {
      background: radial-gradient(circle at top, rgba(248, 113, 113, 0.16), rgba(7, 7, 10, 0.96));
      border: 1px solid rgba(248, 113, 113, 0.35);
      border-radius: 1.25rem;
      padding: 0.85rem;
      box-shadow: 0 24px 50px rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(24px);
      display: flex;
      flex-direction: column;
      position: relative;
      gap: 0.5rem;
      height: 100%;
      overflow: hidden;
    }

    .section-title {
      font-size: 1.4rem;
      font-weight: 900;
      margin-bottom: 0.5rem;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-shrink: 0;
    }

    .queue-list {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      overflow-y: auto;
      padding-right: 0.25rem;
    }

    .barber-card {
      position: relative;
      border-radius: 1rem !important;
      padding: 1.25rem !important;
      background: rgba(10, 10, 12, 0.98) !important;
      border: 1px solid rgba(234, 179, 8, 0.3) !important;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6) !important;
      flex-shrink: 0;
      display: flex !important;
      flex-direction: column !important;
      gap: 1rem !important;
    }

    .barber-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(234, 179, 8, 0.08), transparent 60%);
      opacity: 0.4;
      pointer-events: none;
    }

    /* === ESTILOS ESPEC√çFICOS PARA TURNOS DEL D√çA === */
    /* Estos estilos tienen la m√°xima especificidad para evitar conflictos */
    
    #queueList .barber-card {
      position: relative !important;
      border-radius: 0.9rem !important;
      padding: 0.9rem !important;
      background: linear-gradient(135deg, rgba(15, 15, 18, 0.98), rgba(7, 7, 10, 0.98)) !important;
      border: 1px solid rgba(248, 113, 113, 0.4) !important;
      box-shadow: 0 14px 35px rgba(0, 0, 0, 0.75) !important;
      flex-shrink: 0 !important;
      display: flex !important;
      flex-direction: column !important;
      gap: 0.75rem !important;
    }

    #queueList .barber-header {
      display: flex !important;
      justify-content: space-between !important;
      align-items: center !important;
      padding-bottom: 0.5rem !important;
      margin-bottom: 0.5rem !important;
      border: none !important;
    }

    #queueList .barber-name-section {
      display: flex !important;
      flex-direction: column !important;
      gap: 0.35rem !important;
    }

    #queueList .barber-label {
      font-size: 0.55rem !important;
      text-transform: uppercase !important;
      letter-spacing: 0.22em !important;
      color: rgba(248, 113, 113, 0.9) !important;
      font-weight: 600 !important;
      margin: 0 !important;
    }

    #queueList .barber-name {
      font-size: 1.15rem !important;
      font-weight: 700 !important;
      color: #fff !important;
      letter-spacing: 0.01em !important;
      margin: 0 !important;
      text-transform: none !important;
    }

    #queueList .attending-section {
      border-radius: 0.7rem !important;
      border: 1px solid rgba(248, 113, 113, 0.45) !important;
      background: radial-gradient(circle at top left, rgba(248, 113, 113, 0.18), rgba(12, 10, 10, 0.96)) !important;
      padding: 0.75rem !important;
    }

    #queueList .attending-header {
      display: flex !important;
      justify-content: space-between !important;
      align-items: center !important;
      margin-bottom: 0.4rem !important;
    }

    #queueList .attending-label {
      font-size: 0.55rem !important;
      text-transform: uppercase !important;
      letter-spacing: 0.18em !important;
      color: rgba(248, 113, 113, 0.85) !important;
      font-weight: 600 !important;
    }

    #queueList .attending-badge {
      padding: 0.15rem 0.65rem !important;
      border-radius: 999px !important;
      background: rgba(15, 23, 42, 0.6) !important;
      border: 1px solid rgba(248, 113, 113, 0.7) !important;
      font-size: 0.55rem !important;
      text-transform: uppercase !important;
      letter-spacing: 0.14em !important;
      color: rgba(254, 249, 195, 0.96) !important;
      font-weight: 600 !important;
    }

    #queueList .attending-client {
      font-size: 1.05rem !important;
      font-weight: 700 !important;
      color: #fff !important;
      margin: 0 !important;
    }

    #queueList .queue-section-mini {
      border-radius: 0.7rem !important;
      border: 1px solid rgba(148, 163, 184, 0.45) !important;
      background: rgba(10, 10, 14, 0.95) !important;
      padding: 0.75rem !important;
    }

    #queueList .queue-header {
      display: flex !important;
      justify-content: space-between !important;
      align-items: center !important;
      margin-bottom: 0.4rem !important;
    }

    #queueList .queue-label {
      font-size: 0.55rem !important;
      text-transform: uppercase !important;
      letter-spacing: 0.18em !important;
      color: rgba(248, 113, 113, 0.9) !important;
      font-weight: 600 !important;
    }

    #queueList .queue-badge {
      padding: 0.15rem 0.65rem !important;
      border-radius: 999px !important;
      background: rgba(15, 23, 42, 0.6) !important;
      border: 1px solid rgba(248, 113, 113, 0.6) !important;
      font-size: 0.55rem !important;
      text-transform: uppercase !important;
      letter-spacing: 0.14em !important;
      color: rgba(254, 249, 195, 0.96) !important;
      font-weight: 600 !important;
    }

    #queueList .queue-chips {
      display: grid !important;
      grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
      gap: 0.5rem !important;
    }

    #queueList .queue-chip {
      padding: 0.55rem 0.5rem !important;
      border-radius: 999px !important;
      text-align: center !important;
      font-size: 0.78rem !important;
      font-weight: 600 !important;
      border: 1px solid rgba(148, 163, 184, 0.6) !important;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.7)) !important;
      color: rgba(249, 250, 251, 0.96) !important;
      margin: 0 !important;
    }

    #queueList .queue-chip.empty {
      border-style: dashed !important;
      border-color: rgba(148, 163, 184, 0.5) !important;
      opacity: 0.55 !important;
      color: rgba(148, 163, 184, 0.9) !important;
    }

    .no-queue {
      text-align: center;
      color: rgba(255, 255, 255, 0.5);
      font-size: 1.1rem;
      font-weight: 400;
      margin-top: 2rem;
      padding: 3rem;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      flex-direction: column;
      gap: 1.5rem;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(220, 38, 38, 0.3);
      border-top: 4px solid #dc2626;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Vista minimizada de YouTube */
    .youtube-section.minimized {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 450px;
      height: 280px;
      z-index: 100;
      grid-column: unset;
      grid-row: unset;
    }

    .youtube-section.minimized .youtube-header {
      padding: 0.75rem 1rem;
    }

    .youtube-section.minimized .youtube-title {
      font-size: 1rem;
    }

    .youtube-section.minimized .btn {
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
    }

    .main-content.youtube-minimized {
      grid-template-columns: 1fr;
    }

    .queue-section.expanded {
      grid-column: 1 / -1;
    }

    /* Modo Fullscreen de YouTube */
    .youtube-section.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1000;
      grid-column: unset;
      grid-row: unset;
      background: #000;
    }

    .youtube-section.fullscreen .youtube-player {
      height: calc(100vh - 60px);
    }

    .youtube-section.fullscreen .youtube-header {
      background: rgba(0, 0, 0, 0.9);
    }

    /* Turnos en miniatura cuando YouTube est√° fullscreen */
    .queue-section.mini {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 400px;
      max-height: 500px;
      overflow-y: auto;
      z-index: 1001;
      background: rgba(0, 0, 0, 0.95);
      border-radius: 15px;
      padding: 1rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .queue-section.mini .section-title {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .queue-section.mini .queue-item {
      padding: 0.5rem;
      font-size: 0.85rem;
    }

    /* Modal de confirmaci√≥n para favoritos */
    .favorites-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease;
    }

    .favorites-modal.show {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, rgba(30, 30, 32, 0.98), rgba(50, 50, 55, 0.95));
      border: 2px solid rgba(220, 38, 38, 0.5);
      border-radius: 1.5rem;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      box-shadow: 
        0 0 80px rgba(220, 38, 38, 0.4),
        0 25px 50px rgba(0, 0, 0, 0.8);
      animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      text-align: center;
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: bounce 0.6s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .modal-title {
      font-size: 1.75rem;
      font-weight: 800;
      margin-bottom: 0.75rem;
      background: linear-gradient(135deg, #dc2626, #ef4444);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-message {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 1.5rem;
      line-height: 1.5;
    }

    .modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .modal-btn {
      padding: 0.85rem 2rem;
      border: none;
      border-radius: 0.75rem;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-width: 120px;
    }

    .modal-btn-confirm {
      background: linear-gradient(135deg, rgba(220, 38, 38, 0.9), rgba(185, 28, 28, 0.8));
      color: white;
      box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
    }

    .modal-btn-confirm:hover {
      background: linear-gradient(135deg, rgba(220, 38, 38, 1), rgba(185, 28, 28, 1));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(220, 38, 38, 0.6);
    }

    .modal-btn-cancel {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .modal-btn-cancel:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .modal-btn:active {
      transform: translateY(0);
    }

    /* Removed max-width: 1400px media query to enforce 2-column layout on TV */


    @media (max-width: 900px) {
      body {
        overflow: auto;
      }

      .container {
        height: auto;
        padding-bottom: 3rem;
      }

      .simple-queue-grid {
        grid-template-columns: 1fr;
      }

      .queue-chip-grid.simple.cards {
        grid-template-columns: 1fr;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .mini-barber-card {
      background: linear-gradient(135deg, rgba(15, 15, 18, 0.98), rgba(7, 7, 10, 0.98));
      border-radius: 0.9rem;
      padding: 0.8rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      margin-bottom: 0.8rem;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.7);
    }

    .mini-barber-card.fullscreen {
      padding: 0.9rem;
    }

    .mini-barber-header {
      padding-bottom: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .mini-barber-name-section {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .mini-barber-label {
      font-size: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: rgba(248, 113, 113, 0.9);
      font-weight: 600;
    }

    .mini-barber-name {
      font-size: 1.05rem;
      font-weight: 700;
      color: #fff;
      margin: 0;
    }

    .mini-badge {
      min-width: 30px;
      height: 30px;
      border-radius: 999px;
      background: rgba(239, 68, 68, 0.18);
      border: 1px solid rgba(248, 113, 113, 0.7);
      color: rgba(254, 249, 195, 0.96);
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
    }

    .mini-queue-section {
      border-radius: 0.7rem;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(10, 10, 14, 0.95);
      padding: 0.7rem;
    }

    .mini-queue-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    .mini-queue-label {
      font-size: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: rgba(248, 113, 113, 0.9);
      font-weight: 600;
    }

    .mini-queue-badge {
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(248, 113, 113, 0.6);
      font-size: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(254, 249, 195, 0.96);
      font-weight: 600;
    }

    .mini-attending-section {
      border-radius: 0.7rem;
      border: 1px solid rgba(248, 113, 113, 0.45);
      background: radial-gradient(circle at top left, rgba(248, 113, 113, 0.2), rgba(12, 10, 10, 0.96));
      padding: 0.7rem;
      margin-bottom: 0.7rem;
    }

    .mini-attending-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    .mini-attending-label {
      font-size: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: rgba(248, 113, 113, 0.85);
      font-weight: 600;
    }

    .mini-attending-badge {
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(248, 113, 113, 0.7);
      font-size: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(254, 249, 195, 0.96);
      font-weight: 600;
    }

    .mini-attending-client {
      font-size: 1.05rem;
      font-weight: 700;
      color: #fff;
    }

    .mini-chip-row {
      display: flex;
      gap: 0.5rem;
    }

    .mini-chip {
      flex: 1;
      padding: 0.6rem 0.65rem;
      border-radius: 999px;
      border: 1px solid rgba(234, 179, 8, 0.4);
      background: rgba(20, 16, 5, 0.3);
      color: #fff;
      font-size: 0.75rem;
      font-weight: 600;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .mini-chip.empty {
      border-style: solid;
      border-color: rgba(234, 179, 8, 0.25);
      opacity: 0.5;
      color: rgba(234, 179, 8, 0.6);
    }

    .mini-empty {
      text-align: center;
      padding: 2rem 1rem;
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
    }

    .main-content.youtube-fullscreen {
      grid-template-columns: 1fr;
    }

    /* Ocultar input cuando est√° minimizado */
    .youtube-section.minimized .youtube-input,
    .youtube-section.minimized button:not(:last-child) {
      display: none;
    }

    /* Buscador de YouTube Moderno */
    .youtube-search-container {
      position: relative;
      flex: 1;
      max-width: 600px;
    }

    .youtube-search-input {
      width: 100%;
      padding: 16px 50px 16px 20px;
      border-radius: 50px;
      border: 2px solid transparent;
      background: linear-gradient(135deg, rgba(30, 30, 32, 0.95), rgba(50, 50, 55, 0.9));
      backdrop-filter: blur(20px);
      color: white;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.3),
        inset 0 0 0 1px rgba(220, 38, 38, 0.1);
    }

    .youtube-search-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
      font-weight: 400;
    }

    .youtube-search-input:focus {
      outline: none;
      border-color: rgba(220, 38, 38, 0.8);
      background: linear-gradient(135deg, rgba(40, 40, 45, 0.98), rgba(60, 60, 65, 0.95));
      box-shadow: 
        0 8px 32px rgba(220, 38, 38, 0.3),
        0 0 0 4px rgba(220, 38, 38, 0.1),
        inset 0 0 0 1px rgba(220, 38, 38, 0.3);
      transform: translateY(-2px);
    }

    .youtube-search-input:hover:not(:focus) {
      border-color: rgba(220, 38, 38, 0.4);
      box-shadow: 
        0 6px 24px rgba(0, 0, 0, 0.4),
        inset 0 0 0 1px rgba(220, 38, 38, 0.2);
    }

    /* Icono de b√∫squeda animado */
    .search-icon {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      color: rgba(220, 38, 38, 0.7);
      pointer-events: none;
      transition: all 0.3s ease;
    }

    .youtube-search-input:focus ~ .search-icon {
      color: rgba(220, 38, 38, 1);
      transform: translateY(-50%) scale(1.1) rotate(90deg);
    }

    .search-results {
      position: absolute;
      top: calc(100% + 12px);
      left: 0;
      right: 0;
      background: linear-gradient(135deg, rgba(20, 20, 22, 0.98), rgba(30, 30, 35, 0.96));
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(220, 38, 38, 0.3);
      max-height: 450px;
      overflow-y: auto;
      overflow-x: hidden;
      z-index: 1000;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(220, 38, 38, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      display: none;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .search-results.show {
      display: block;
    }

    .search-result-item {
      display: flex;
      gap: 14px;
      padding: 14px 16px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .search-result-item:last-child {
      border-bottom: none;
    }

    .search-result-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, #dc2626, #ef4444);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .search-result-item:hover {
      background: linear-gradient(90deg, rgba(220, 38, 38, 0.15), rgba(220, 38, 38, 0.05));
      padding-left: 20px;
    }

    .search-result-item:hover::before {
      transform: scaleY(1);
    }

    .search-result-thumbnail {
      width: 140px;
      height: 78px;
      border-radius: 10px;
      object-fit: cover;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
    }

    .search-result-item:hover .search-result-thumbnail {
      transform: scale(1.05);
    }

    .search-result-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .search-result-title {
      font-size: 14px;
      font-weight: 600;
      color: white;
      margin-bottom: 6px;
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .search-result-channel {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 500;
    }

    .search-loading, .search-no-results {
      padding: 32px 20px;
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
    }

    .search-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .search-loading::before {
      content: 'üîç';
      font-size: 32px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }

    /* Panel de turnos en miniatura - NEGRO CON DORADO */
    .queue-miniatura {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 380px;
      max-height: 500px;
      background: rgba(10, 10, 12, 0.98);
      backdrop-filter: blur(30px) saturate(180%);
      border: 2px solid rgba(234, 179, 8, 0.5);
      border-radius: 16px;
      padding: 1.5rem;
      z-index: 2147483647 !important;
      box-shadow: 
        0 30px 80px rgba(0, 0, 0, 0.95),
        0 0 0 1px rgba(234, 179, 8, 0.3),
        inset 0 1px 0 rgba(234, 179, 8, 0.1),
        0 0 40px rgba(234, 179, 8, 0.25);
      overflow: hidden;
      display: none;
      opacity: 0;
      visibility: hidden;
      transform: translateY(30px) scale(0.95);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      pointer-events: none;
    }

    /* Cuando el body tiene video en fullscreen - M√ÅXIMA PRIORIDAD */
    body.video-fullscreen .queue-miniatura.show {
      position: fixed !important;
      z-index: 2147483647 !important;
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
      pointer-events: auto !important;
      /* Forzar que est√© al frente usando todos los trucos */
      isolation: isolate;
      will-change: transform, opacity;
      transform: translateZ(999999px); /* GPU layer al frente */
    }

    /* Backdrop de fullscreen - aparece sobre el video */
    *:fullscreen::backdrop,
    *:-webkit-full-screen::backdrop,
    *:-moz-full-screen::backdrop {
      background: transparent !important;
    }

    /* Forzar panel sobre cualquier fullscreen */
    html:has(*:fullscreen) .queue-miniatura.show,
    html:has(*:-webkit-full-screen) .queue-miniatura.show,
    html:has(*:-moz-full-screen) .queue-miniatura.show {
      position: fixed !important;
      z-index: 2147483647 !important;
      isolation: isolate !important;
      transform: translate3d(0, 0, 999999px) !important;
    }

    /* Panel que aparece DENTRO del contenedor fullscreen - COMPACTO Y TRANSPARENTE */
    .queue-miniatura-fullscreen {
      position: absolute;
      bottom: 1rem;
      right: 1rem;
      width: 280px;
      max-height: 350px;
      background: linear-gradient(135deg, rgba(10, 10, 10, 0.75), rgba(20, 20, 20, 0.7));
      backdrop-filter: blur(20px) saturate(150%);
      border: 1.5px solid rgba(220, 38, 38, 0.5);
      border-radius: 16px;
      padding: 1rem;
      z-index: 999999;
      box-shadow: 
        0 20px 50px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(220, 38, 38, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.03),
        0 0 30px rgba(220, 38, 38, 0.2);
      display: flex;
      flex-direction: column;
      animation: slideUpSmooth 0.4s ease-out;
    }

    /* Ajustar video en fullscreen para que no se tape con el panel */
    .youtube-player-container:fullscreen #ytplayer,
    .youtube-player-container:-webkit-full-screen #ytplayer,
    .youtube-player-container:-moz-full-screen #ytplayer {
      width: calc(100% - 300px) !important;
      margin-right: auto;
    }

    @keyframes slideUpSmooth {
      0% {
        opacity: 0;
        transform: translateY(20px) scale(0.98);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .queue-miniatura.show {
      opacity: 1 !important;
      visibility: visible !important;
      transform: translateY(0) scale(1) !important;
      pointer-events: auto !important;
      display: flex !important;
      flex-direction: column !important;
      animation: slideUpSmooth 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      z-index: 2147483647 !important;
    }

    /* Forzar que sea visible sobre TODO en fullscreen */
    :-webkit-full-screen .queue-miniatura.show,
    :-moz-full-screen .queue-miniatura.show,
    :fullscreen .queue-miniatura.show {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    /* Borde sutil sin animaci√≥n llamativa */
    .queue-miniatura.show::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 18px;
      padding: 1px;
      background: linear-gradient(135deg, 
        rgba(220, 38, 38, 0.3), 
        rgba(239, 68, 68, 0.15), 
        rgba(220, 38, 38, 0.3)
      );
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.6;
      pointer-events: none;
    }

    .queue-miniatura-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(234, 179, 8, 0.25);
    }

    .queue-miniatura-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: rgba(250, 204, 21, 0.9);
      display: flex;
      align-items: center;
      gap: 0.35rem;
      opacity: 0.9;
    }

    .queue-miniatura-close {
      background: rgba(234, 179, 8, 0.15);
      border: 1px solid rgba(234, 179, 8, 0.3);
      border-radius: 6px;
      color: rgba(255, 255, 255, 0.75);
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      font-size: 0.75rem;
      font-weight: 600;
      transition: all 0.2s ease;
      backdrop-filter: blur(6px);
      opacity: 0.75;
    }

    .queue-miniatura-close:hover {
      background: rgba(234, 179, 8, 0.3);
      border-color: rgba(234, 179, 8, 0.5);
      transform: scale(1.05);
      opacity: 1;
    }

    .queue-miniatura-close:active {
      transform: scale(0.95);
    }

    /* Estilos responsivos para fullscreen - Discreto en todas las resoluciones */
    @media (max-width: 1024px) {
      .queue-miniatura {
        width: 320px;
        max-height: 420px;
        bottom: 1.25rem;
        right: 1.25rem;
      }
    }

    @media (max-width: 768px) {
      .queue-miniatura {
        width: 300px;
        max-width: calc(100% - 2rem);
        bottom: 1rem;
        right: 1rem;
        max-height: 380px;
      }
    }

    @media (max-width: 480px) {
      .queue-miniatura {
        width: calc(100% - 1.5rem);
        bottom: 0.75rem;
        right: 0.75rem;
        left: 0.75rem;
        max-height: 320px;
        padding: 1rem;
      }

      .queue-miniatura-title {
        font-size: 0.8rem;
      }

      .queue-miniatura-item {
        padding: 0.5rem;
        font-size: 0.75rem;
      }
    }

    /* Ajustes para pantallas ultra anchas - Mantener discreto */
    @media (min-width: 1920px) {
      .queue-miniatura {
        width: 360px;
        max-height: 480px;
        bottom: 2rem;
        right: 2rem;
      }
    }

    .queue-miniatura-content {
      flex: 1;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(234, 179, 8, 0.5) transparent;
    }

    .queue-miniatura-content::-webkit-scrollbar {
      width: 6px;
    }

    .queue-miniatura-content::-webkit-scrollbar-thumb {
      background: rgba(234, 179, 8, 0.5);
      border-radius: 10px;
    }

    .queue-miniatura-content::-webkit-scrollbar-thumb:hover {
      background: rgba(234, 179, 8, 0.7);
    }

    .queue-miniatura-item {
      padding: 0.5rem;
      margin-bottom: 0.35rem;
      background: rgba(25, 25, 27, 0.4);
      border: 1px solid rgba(234, 179, 8, 0.12);
      border-radius: 6px;
      transition: all 0.2s ease;
      font-size: 0.75rem;
    }

    .queue-miniatura-item:hover {
      background: rgba(234, 179, 8, 0.1);
      border-color: rgba(234, 179, 8, 0.25);
      transform: translateX(1px);
    }

    .queue-miniatura-item.attending {
      background: linear-gradient(135deg, rgba(234, 179, 8, 0.18), rgba(250, 204, 21, 0.2));
      border-color: rgba(234, 179, 8, 0.4);
      box-shadow: 0 0 10px rgba(234, 179, 8, 0.2);
    }

    /* Tabs del reproductor */
    .youtube-tabs {
      display: flex;
      gap: 0.5rem;
      padding: 0.75rem;
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(220, 38, 38, 0.3);
    }

    .tab-btn {
      padding: 0.5rem 1rem;
      background: transparent;
      border: 1px solid rgba(220, 38, 38, 0.3);
      border-radius: 0.5rem;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .tab-btn:hover {
      background: rgba(220, 38, 38, 0.2);
      border-color: rgba(220, 38, 38, 0.5);
      color: white;
    }

    .tab-btn.active {
      background: rgba(220, 38, 38, 0.4);
      border-color: rgba(220, 38, 38, 0.6);
      color: white;
    }

    /* Contenido de tabs */
    .tab-content {
      display: none;
      padding: 0;
      flex: 1;
      overflow-y: auto;
      min-height: 0;
      scrollbar-width: thin;
      scrollbar-color: rgba(220, 38, 38, 0.5) transparent;
    }

    .tab-content::-webkit-scrollbar {
      width: 8px;
    }

    .tab-content::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }

    .tab-content::-webkit-scrollbar-thumb {
      background: rgba(220, 38, 38, 0.5);
      border-radius: 10px;
    }

    .tab-content::-webkit-scrollbar-thumb:hover {
      background: rgba(220, 38, 38, 0.7);
    }

    .tab-content.active {
      display: flex;
      flex-direction: column;
    }

    .tab-content#tab-player {
      padding: 0;
      height: 100%;
    }

    .tab-content#tab-inicio,
    .tab-content#tab-buscar,
    .tab-content#tab-favoritos {
      padding: 0;
    }

    /* Videos grid (inicio y favoritos) - Mejorado y compacto */
    .videos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 0.85rem;
      padding: 0.75rem;
    }

    .video-card {
      background: linear-gradient(135deg, rgba(25, 25, 28, 0.95), rgba(35, 35, 40, 0.9));
      backdrop-filter: blur(10px);
      border: 1.5px solid rgba(220, 38, 38, 0.25);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .video-card::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 16px;
      padding: 1.5px;
      background: linear-gradient(135deg, 
        rgba(220, 38, 38, 0.3), 
        rgba(239, 68, 68, 0.15), 
        rgba(220, 38, 38, 0.3)
      );
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .video-card:hover {
      border-color: rgba(220, 38, 38, 0.6);
      transform: translateY(-4px) scale(1.02);
      box-shadow: 
        0 8px 20px rgba(0, 0, 0, 0.5),
        0 0 20px rgba(220, 38, 38, 0.3);
    }

    .video-card:hover::before {
      opacity: 1;
    }

    .video-card-thumbnail {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
      transition: transform 0.3s ease;
      position: relative;
      background: #000;
    }

    .video-card:hover .video-card-thumbnail {
      transform: scale(1.05);
    }

    /* Overlay con icono play */
    .video-card-thumbnail::after {
      content: '‚ñ∂';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3rem;
      color: white;
      opacity: 0;
      transition: opacity 0.3s ease;
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.8);
      pointer-events: none;
    }

    .video-card:hover .video-card-thumbnail::after {
      opacity: 0.9;
    }

    .video-card-info {
      padding: 0.75rem;
      background: linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.3));
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .video-card-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.35rem;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      line-height: 1.3;
    }

    .video-card-channel {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 500;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .video-card-actions {
      display: flex;
      gap: 0.5rem;
      padding: 0.65rem;
      border-top: 1px solid rgba(220, 38, 38, 0.15);
      background: rgba(0, 0, 0, 0.3);
    }

    .video-card-btn {
      flex: 1;
      padding: 0.5rem 0.4rem;
      background: linear-gradient(135deg, rgba(220, 38, 38, 0.3), rgba(239, 68, 68, 0.25));
      border: 1px solid rgba(220, 38, 38, 0.4);
      border-radius: 8px;
      color: white;
      font-size: 0.7rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      text-transform: uppercase;
      letter-spacing: 0.3px;
      white-space: nowrap;
    }

    .video-card-btn:hover {
      background: linear-gradient(135deg, rgba(220, 38, 38, 0.6), rgba(239, 68, 68, 0.5));
      border-color: rgba(220, 38, 38, 0.7);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(220, 38, 38, 0.4);
    }

    .video-card-btn:active {
      transform: translateY(0);
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: rgba(255, 255, 255, 0.5);
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* === ESTILOS DUPLICADOS REMOVIDOS === */
    /* Los estilos espec√≠ficos con #queueList ya est√°n definidos arriba */
    /* Estos duplicados sin prefijo causaban conflictos de especificidad */
  </style>
</head>
<body
  data-supabase-url={PUBLIC_SUPABASE_URL ?? ''}
  data-supabase-anon-key={PUBLIC_SUPABASE_ANON_KEY ?? ''}
  data-youtube-api-key={PUBLIC_YOUTUBE_API_KEY ?? ''}
>
  <div class="stars-layer"></div>
  
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="brand">
          <span class="brand-icon">‚úÇÔ∏è</span>
          <span class="brand-text">JP BARBER</span>
        </div>
        <p class="subtitle">Experiencia Premium | Turnos en tiempo real</p>
      </div>
      <div class="header-right">
        <div class="current-time" id="currentTime"></div>
        <div class="current-date" id="currentDate"></div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
      <!-- YouTube Section -->
      <section class="youtube-section" id="youtubeSection">
        <div class="youtube-header">
          <h2 class="youtube-title">üéµ M√∫sica & Entretenimiento</h2>
        </div>
        
        <!-- Tabs de navegaci√≥n -->
        <div class="youtube-tabs">
          <button class="tab-btn" data-tab="inicio" onclick="switchTab('inicio')">üè† Inicio</button>
          <button class="tab-btn" data-tab="buscar" onclick="switchTab('buscar')">üîç Buscar</button>
          <button class="tab-btn" data-tab="favoritos" onclick="switchTab('favoritos')">‚≠ê Favoritos</button>
          <button class="tab-btn active" data-tab="player" onclick="switchTab('player')">‚ñ∂Ô∏è Reproductor</button>
        </div>

        <!-- Tab: Inicio (Videos sugeridos) -->
        <div class="tab-content" id="tab-inicio">
          <div class="videos-grid" id="videosInicio"></div>
        </div>

        <!-- Tab: Buscar -->
        <div class="tab-content" id="tab-buscar">
          <div class="youtube-search-container" style="max-width: 100%; margin-bottom: 1rem;">
            <input 
              type="text" 
              id="youtubeSearchInput" 
              placeholder="Buscar m√∫sica, artistas, canciones..." 
              class="youtube-search-input"
              autocomplete="off"
            >
            <span class="search-icon">üîç</span>
            <div class="search-results" id="searchResults"></div>
          </div>
          <div class="videos-grid" id="searchResultsGrid"></div>
        </div>

        <!-- Tab: Favoritos -->
        <div class="tab-content" id="tab-favoritos">
          <div class="videos-grid" id="videosFavoritos"></div>
        </div>

        <!-- Tab: Reproductor -->
        <div class="tab-content active" id="tab-player">
          <div class="youtube-player-container" id="youtubePlayerContainer">
            <div class="youtube-player">
              <div id="ytplayer"></div>
            </div>
            
            <!-- Bot√≥n fullscreen custom -->
            <button class="custom-fullscreen-btn" id="customFullscreenBtn" onclick="toggleCustomFullscreen()" title="Pantalla completa">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
              </svg>
            </button>
            
            <!-- Panel de turnos dentro del contenedor para que aparezca en fullscreen -->
            <div class="queue-miniatura-fullscreen" id="queueMiniaturaFullscreen" style="display: none;">
              <div class="queue-miniatura-header">
                <div class="queue-miniatura-title">üìã Turnos</div>
                <button class="queue-miniatura-close" onclick="toggleQueueMiniatura()">‚úï</button>
              </div>
              <div class="queue-miniatura-content" id="queueMiniaturaFullscreenContent">
                <div class="loading">
                  <div class="spinner"></div>
                  <p>Cargando turnos...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Cola de Turnos -->
      <section class="queue-section" id="queueSection">
        <h2 class="section-title">üìã Turnos del D√≠a</h2>
        <div class="queue-list" id="queueList">
          <div class="loading">
            <div class="spinner"></div>
            <p>Cargando turnos...</p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Panel de turnos en miniatura (flotante) -->
  <div class="queue-miniatura" id="queueMiniatura">
    <div class="queue-miniatura-header">
      <div class="queue-miniatura-title">üìã Turnos</div>
      <button class="queue-miniatura-close" onclick="toggleQueueMiniatura()">‚úï</button>
    </div>
    <div class="queue-miniatura-content" id="queueMiniaturaContent">
      <div class="loading">
        <div class="spinner"></div>
        <p>Cargando turnos...</p>
      </div>
    </div>
  </div>

  <script>
    // @ts-nocheck
    // Configuraci√≥n de Supabase y YouTube (inyectadas desde Astro)
    const { supabaseUrl = '', supabaseAnonKey = '', youtubeApiKey = '' } = document.body?.dataset || {};
    const SUPABASE_URL = supabaseUrl;
    const SUPABASE_ANON_KEY = supabaseAnonKey;
    const YOUTUBE_API_KEY = youtubeApiKey;

    let supabaseClient = null;
    let youtubePlayer = null;
    let isYoutubeMinimized = false;
    let isYoutubeFullscreen = false;
    let refreshInterval = null;
    let currentVideoId = null;
    let searchTimeout = null;
    let isNativeFullscreen = false;
    let latestQueueSnapshot = [];

    const sanitizeText = (text = '') => text.replace(/[<>]/g, '');

    const STATUS_PRIORITY = {
      in_chair: 0,
      in_progress: 0,
      finishing: 1,
      waiting: 2,
      called: 2,
      confirmed: 3,
      scheduled: 4,
      pending: 5,
    };

    const WAITING_STATES = new Set(['waiting', 'called']);
    const UPCOMING_STATES = new Set(['confirmed', 'scheduled', 'pending']);
    // Sincronizar con cola-virtual: estados activos
    const ACTIVE_STATUSES = new Set(['scheduled', 'confirmed', 'in_progress', 'pending', 'waiting', 'in_chair']);
    const BLOCKED_STATUSES = new Set(['completed', 'cancelled', 'no_show']);

    const STATUS_LABELS = {
      in_chair: 'En silla',
      in_progress: 'Atendiendo',
      finishing: 'Finalizando',
      waiting: 'En cola',
      called: 'Llamado',
      confirmed: 'Confirmada',
      scheduled: 'Agendada',
      pending: 'Pendiente',
      cancelled: 'Cancelada',
      no_show: 'No asisti√≥',
    };

    const STATUS_BADGE = {
      in_chair: 'badge-active',
      in_progress: 'badge-active',
      finishing: 'badge-active',
      waiting: 'badge-waiting',
      called: 'badge-waiting',
      confirmed: 'badge-upcoming',
      scheduled: 'badge-upcoming',
      pending: 'badge-upcoming',
      cancelled: 'badge-cancelled',
      no_show: 'badge-cancelled',
    };

    // Detectar cambios en modo pantalla completa nativo
    function setupFullscreenDetection() {
      const fullscreenEvents = ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange'];
      
      fullscreenEvents.forEach(eventName => {
        document.addEventListener(eventName, handleFullscreenChange, false);
      });
      
      console.log('‚úÖ Detecci√≥n de pantalla completa configurada');
    }

    let fullscreenTimeout = null;
    let lastFullscreenState = false;
    let fullscreenDebounce = null;

    // Manejar cambios de pantalla completa con debounce
    function handleFullscreenChange() {
      // Limpiar debounce anterior
      if (fullscreenDebounce) {
        clearTimeout(fullscreenDebounce);
      }

      // Esperar 100ms para ver si hay m√°s eventos
      fullscreenDebounce = setTimeout(() => {
        const fullscreenElement = 
          document.fullscreenElement || 
          document.webkitFullscreenElement || 
          document.mozFullScreenElement || 
          document.msFullscreenElement;

        const isCurrentlyFullscreen = !!fullscreenElement;
        
        // Solo actuar si el estado realmente cambi√≥
        if (isCurrentlyFullscreen === lastFullscreenState) {
          console.log('‚è≠Ô∏è Evento duplicado ignorado');
          return;
        }
        
        lastFullscreenState = isCurrentlyFullscreen;
        isNativeFullscreen = isCurrentlyFullscreen;
        
        const queueMiniatura = document.getElementById('queueMiniatura');
        
        if (isCurrentlyFullscreen) {
          console.log('üì∫ Entrando en pantalla completa - Mostrando panel de turnos');
          console.log('üìç Elemento en fullscreen:', fullscreenElement?.tagName);
          
          // Agregar clase especial al body
          document.body.classList.add('video-fullscreen');
          
          // Mostrar SOLO el panel principal con estilos inline forzados
          queueMiniatura.classList.add('show');
          
          // FORZAR display y visibilidad inmediatamente
          queueMiniatura.style.display = 'flex';
          queueMiniatura.style.flexDirection = 'column';
          queueMiniatura.style.opacity = '1';
          queueMiniatura.style.visibility = 'visible';
          queueMiniatura.style.pointerEvents = 'auto';
          
          renderQueueMiniatura();
          
          console.log('‚úÖ Panel activado con display flex forzado');
          
          // Verificar que realmente est√© visible
          setTimeout(() => {
            // Forzar estilos inline para asegurar visibilidad
            queueMiniatura.style.position = 'fixed';
            queueMiniatura.style.zIndex = '2147483647';
            queueMiniatura.style.bottom = '2rem';
            queueMiniatura.style.right = '2rem';
            queueMiniatura.style.display = 'flex';
            queueMiniatura.style.opacity = '1';
            queueMiniatura.style.visibility = 'visible';
            queueMiniatura.style.pointerEvents = 'auto';
            
            const styles = window.getComputedStyle(queueMiniatura);
            const rect = queueMiniatura.getBoundingClientRect();
            
            console.log('‚úÖ Panel de turnos visible');
            console.log('üìä Estado del panel:', {
              display: styles.display,
              opacity: styles.opacity,
              visibility: styles.visibility,
              zIndex: styles.zIndex,
              position: styles.position,
              bottom: styles.bottom,
              right: styles.right,
              width: styles.width,
              parent: queueMiniatura.parentElement?.tagName,
              hasShowClass: queueMiniatura.classList.contains('show')
            });
            
            console.log('üìê Posici√≥n en pantalla:', {
              top: rect.top,
              left: rect.left,
              bottom: rect.bottom,
              right: rect.right,
              width: rect.width,
              height: rect.height
            });
            
            console.log('üéØ PANEL ROJO DEBER√çA SER VISIBLE - Esquina inferior derecha');
            console.log('üî¥ Fondo ROJO BRILLANTE con border BLANCO');
            console.log('üìç Fullscreen element:', fullscreenElement?.tagName);
            
            // Verificar si est√° en viewport
            const inViewport = rect.top >= 0 && rect.left >= 0 && 
                              rect.bottom <= window.innerHeight && 
                              rect.right <= window.innerWidth;
            console.log('üëÅÔ∏è Panel en viewport:', inViewport);
            
            if (!inViewport) {
              console.warn('‚ö†Ô∏è PANEL FUERA DEL VIEWPORT - Ajustando posici√≥n');
              queueMiniatura.style.top = 'auto';
              queueMiniatura.style.bottom = '2rem';
              queueMiniatura.style.right = '2rem';
              queueMiniatura.style.left = 'auto';
            }
          }, 100);
          
          // Mantener visible mientras est√© en fullscreen
          const keepAliveInterval = setInterval(() => {
            const stillFullscreen = !!(
              document.fullscreenElement || 
              document.webkitFullscreenElement || 
              document.mozFullScreenElement || 
              document.msFullscreenElement
            );
            
            if (stillFullscreen) {
              // Asegurar que siga visible
              if (!queueMiniatura.classList.contains('show')) {
                console.log('üîÑ Re-activando panel');
                queueMiniatura.classList.add('show');
              }
            } else {
              clearInterval(keepAliveInterval);
            }
          }, 500);
          
        } else {
          console.log('üì∫ Saliendo de pantalla completa - Ocultando panel de turnos');
          
          // Remover clase del body
          document.body.classList.remove('video-fullscreen');
          
          // OCULTAR panel completamente removiendo clase y estilos inline
          queueMiniatura.classList.remove('show');
          
          // Remover TODOS los estilos inline forzados
          queueMiniatura.style.display = 'none';
          queueMiniatura.style.opacity = '0';
          queueMiniatura.style.visibility = 'hidden';
          queueMiniatura.style.pointerEvents = 'none';
          
          // Limpiar estilos de posici√≥n tambi√©n
          queueMiniatura.style.position = '';
          queueMiniatura.style.zIndex = '';
          queueMiniatura.style.bottom = '';
          queueMiniatura.style.right = '';
          queueMiniatura.style.flexDirection = '';
          
          console.log('‚úÖ Panel de turnos oculto completamente');
        }
      }, 100);
    }

    // Funci√≥n auxiliar para verificar si estamos en fullscreen
    function isInFullscreen() {
      return !!(
        document.fullscreenElement || 
        document.webkitFullscreenElement || 
        document.mozFullScreenElement || 
        document.msFullscreenElement
      );
    }

    // Funci√≥n para inicializar Supabase cuando est√© disponible
    function initSupabase() {
      return new Promise((resolve, reject) => {
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
          reject(new Error('Supabase no est√° configurado. Define PUBLIC_SUPABASE_URL y PUBLIC_SUPABASE_ANON_KEY.'));
          return;
        }
        const checkSupabase = () => {
          if (window.supabase && window.supabase.createClient) {
            const { createClient } = window.supabase;
            supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase inicializado correctamente');
            resolve(supabaseClient);
          } else {
            setTimeout(checkSupabase, 100);
          }
        };
        checkSupabase();
      });
    }

    // YouTube API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    let playerReady = false;

    // Event handlers del player
    function onPlayerReady(event) {
      playerReady = true;
      console.log('‚úÖ YouTube Player listo para reproducir');
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        console.log('‚ñ∂Ô∏è Video reproduci√©ndose');
      }
    }

    // Inicializar YouTube Player
    window.onYouTubeIframeAPIReady = function() {
      youtubePlayer = new YT.Player('ytplayer', {
        height: '100%',
        width: '100%',
        playerVars: {
          'autoplay': 1,
          'controls': 1,
          'rel': 0,
          'showinfo': 0,
          'modestbranding': 1,
          'fs': 0, // DESHABILITAR fullscreen de YouTube
          'playsinline': 1
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
      console.log('‚úÖ YouTube Player inicializado');
    };

    // Buscar videos en YouTube
    async function searchYouTube(query) {
      const trimmedQuery = (query || '').trim();

      if (trimmedQuery.length < 2) {
        document.getElementById('searchResults').classList.remove('show');
        return;
      }

      const searchResults = document.getElementById('searchResults');
      searchResults.innerHTML = '<div class="search-loading">üîç Buscando...</div>';
      searchResults.classList.add('show');

      if (!YOUTUBE_API_KEY) {
        searchResults.innerHTML = '<div class="search-no-results">Configura PUBLIC_YOUTUBE_API_KEY para habilitar la b√∫squeda.</div>';
        return;
      }

      try {
        const params = new URLSearchParams({
          part: 'snippet',
          q: trimmedQuery,
          type: 'video',
          maxResults: '8',
          key: YOUTUBE_API_KEY
        });

        const response = await fetch(`https://www.googleapis.com/youtube/v3/search?${params.toString()}`);
        const data = await response.json();

        if (!response.ok) {
          const apiMessage = data?.error?.message || 'Error al buscar videos';
          throw new Error(apiMessage);
        }

        if (!Array.isArray(data.items) || data.items.length === 0) {
          searchResults.innerHTML = '<div class="search-no-results">No se encontraron resultados</div>';
          return;
        }

        // Mostrar en dropdown (antiguo)
        searchResults.innerHTML = data.items.map(item => `
          <div class="search-result-item" onclick="selectVideo('${item.id.videoId}', '${item.snippet.title.replace(/'/g, "\\'")}', '${item.snippet.channelTitle.replace(/'/g, "\\'")}')">
            <img src="${item.snippet.thumbnails.default.url}" alt="${item.snippet.title}" class="search-result-thumbnail">
            <div class="search-result-info">
              <div class="search-result-title">${item.snippet.title}</div>
              <div class="search-result-channel">${item.snippet.channelTitle}</div>
            </div>
          </div>
        `).join('');

        // Mostrar en grid de cards
        const searchGrid = document.getElementById('searchResultsGrid');
        if (searchGrid) {
          const videos = data.items.map(item => ({
            id: item.id.videoId,
            title: item.snippet.title,
            channel: item.snippet.channelTitle,
            thumbnail: item.snippet.thumbnails.medium.url
          }));
          searchGrid.innerHTML = videos.map(video => createVideoCard(video, true, false)).join('');
        }

        console.log('‚úÖ B√∫squeda completada:', data.items.length, 'resultados');
      } catch (error) {
        console.error('‚ùå Error al buscar videos:', error);
        const friendlyMessage = sanitizeText(error?.message || 'Error al buscar. Intenta nuevamente.');
        searchResults.innerHTML = `<div class="search-no-results">${friendlyMessage}</div>`;
      }
    }

    // Videos sugeridos - Anuel AA y Blessd al inicio, luego m√∫sica popular
    // IDs seleccionados de videos oficiales que funcionan correctamente
    const videosSugeridos = [
      // Anuel AA (videos oficiales)
      { id: 'BTtBmo5EbEk', title: 'Anuel AA - Ella Quiere Beber', channel: 'Anuel AA' },
      { id: 'hP1WR1Aeq3Q', title: 'Anuel AA - China (ft. Daddy Yankee, Karol G, Ozuna & J Balvin)', channel: 'Anuel AA' },
      { id: 'gFZfwWZV074', title: 'Anuel AA, KAROL G - Secreto', channel: 'Anuel AA' },
      { id: 'FXeDN7sQk30', title: 'Anuel AA - Keii', channel: 'Anuel AA' },
      // Blessd (videos oficiales)
      { id: 'zcw8NlHljF4', title: 'Blessd x Ovy On The Drums - M√çRAME (Video Oficial)', channel: 'Blessd' },
      { id: 'c2SajzhfSfI', title: 'Blessd ‚ùå Ovy On The Drums - BILLBOARD (Official Video)', channel: 'Blessd' },
      { id: '76TtU2cUMB4', title: 'Blessd ‚ùå Ovy On The Drums - Casi Algo (Video Oficial)', channel: 'Blessd' },
      { id: '2ucJrszbGCs', title: 'Blessd, Ryan Castro - ADC (Video Oficial)', channel: 'Blessd' },
      // M√∫sica popular
      { id: 'kJQP7kiw5Fk', title: 'Luis Fonsi - Despacito ft. Daddy Yankee', channel: 'Luis Fonsi' },
      { id: 'RgKAFK5djSk', title: 'Wiz Khalifa - See You Again ft. Charlie Puth', channel: 'Wiz Khalifa' },
      { id: '60ItHLz5WEA', title: 'Alan Walker - Faded', channel: 'Alan Walker' },
      { id: 'OPf0YbXqDm0', title: 'Mark Ronson - Uptown Funk ft. Bruno Mars', channel: 'Mark Ronson' },
      { id: '09R8_2nJtjg', title: 'Maroon 5 - Sugar', channel: 'Maroon 5' },
      { id: 'JGwWNGJdvx8', title: 'Ed Sheeran - Shape of You', channel: 'Ed Sheeran' },
      { id: 'CevxZvSJLk8', title: 'Katy Perry - Roar', channel: 'Katy Perry' },
      { id: 'lDK9QqIzhwk', title: 'Sia - Cheap Thrills', channel: 'Sia' },
    ];

    // Gesti√≥n de favoritos con localStorage
    function getFavoritos() {
      const stored = localStorage.getItem('jpbarber_favoritos');
      return stored ? JSON.parse(stored) : [];
    }

    function saveFavoritos(favoritos) {
      localStorage.setItem('jpbarber_favoritos', JSON.stringify(favoritos));
    }

    function agregarFavorito(video) {
      const favoritos = getFavoritos();
      if (!favoritos.find(v => v.id === video.id)) {
        favoritos.push(video);
        saveFavoritos(favoritos);
        renderFavoritos();
        showModal('‚ú®', 'Agregado a Favoritos', `"${video.title}" se agreg√≥ exitosamente a tus favoritos.`, 'success');
      } else {
        showModal('‚ÑπÔ∏è', 'Ya en Favoritos', `"${video.title}" ya est√° en tu lista de favoritos.`, 'info');
      }
    }

    function quitarFavorito(videoId) {
      const videoToRemove = getFavoritos().find(v => v.id === videoId);
      showModal(
        'üóëÔ∏è',
        'Eliminar de Favoritos',
        `¬øEst√°s seguro de eliminar "${videoToRemove?.title || 'este video'}" de tus favoritos?`,
        'confirm',
        () => {
          const favoritos = getFavoritos().filter(v => v.id !== videoId);
          saveFavoritos(favoritos);
          renderFavoritos();
          showModal('‚úÖ', 'Eliminado', 'Video eliminado de favoritos exitosamente.', 'success');
        }
      );
    }

    // Seleccionar y reproducir video (global para onclick)
    window.selectVideo = function(videoId, title, channel) {
      console.log('üé¨ Intentando reproducir:', title, 'ID:', videoId);
      
      if (!youtubePlayer) {
        console.error('‚ùå YouTube Player no est√° inicializado');
        return;
      }

      // Esperar a que el player est√© listo
      const playVideo = () => {
        try {
          youtubePlayer.loadVideoById({
            videoId: videoId,
            startSeconds: 0,
            suggestedQuality: 'large'
          });
          
          // Intentar reproducir despu√©s de un breve delay
          setTimeout(() => {
            if (youtubePlayer.playVideo) {
              youtubePlayer.playVideo();
            }
          }, 500);
          
          currentVideoId = videoId;
          console.log('‚úÖ Video cargado:', title);
          
          // Cambiar autom√°ticamente al tab del reproductor
          switchTab('player');
          
          // Ocultar resultados si est√°n en b√∫squeda
          const searchResults = document.getElementById('searchResults');
          if (searchResults) searchResults.classList.remove('show');
        } catch (error) {
          console.error('‚ùå Error al cargar video:', error);
        }
      };

      if (playerReady) {
        playVideo();
      } else {
        console.log('‚è≥ Esperando a que el player est√© listo...');
        setTimeout(playVideo, 1000);
      }
    };

    // Agregar a favoritos desde onclick
    window.addToFavorites = function(videoId, title, channel) {
      agregarFavorito({ id: videoId, title, channel });
    };

    // Quitar de favoritos desde onclick
    window.removeFromFavorites = function(videoId) {
      quitarFavorito(videoId);
    };

    // Cambiar de tab
    window.switchTab = function(tabName) {
      // Actualizar botones
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === tabName);
      });

      // Actualizar contenido
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`tab-${tabName}`).classList.add('active');

      // NO mostrar panel autom√°ticamente - solo en fullscreen nativo
      // El panel de turnos miniatura SOLO aparece con fullscreenchange event

      // Cargar contenido si es necesario
      if (tabName === 'favoritos') {
        renderFavoritos();
      }
    };

    // Toggle panel de turnos en miniatura
    window.toggleQueueMiniatura = function() {
      const fullscreenPanel = document.getElementById('queueMiniaturaFullscreen');
      if (fullscreenPanel) {
        fullscreenPanel.style.display = fullscreenPanel.style.display === 'none' ? 'flex' : 'none';
      }
    };

    // Toggle fullscreen CUSTOM del contenedor completo
    window.toggleCustomFullscreen = function() {
      const container = document.getElementById('youtubePlayerContainer');
      
      if (!document.fullscreenElement && 
          !document.webkitFullscreenElement && 
          !document.mozFullScreenElement && 
          !document.msFullscreenElement) {
        // Entrar en fullscreen
        console.log('üé¨ Entrando en fullscreen CUSTOM del contenedor');
        
        if (container.requestFullscreen) {
          container.requestFullscreen();
        } else if (container.webkitRequestFullscreen) {
          container.webkitRequestFullscreen();
        } else if (container.mozRequestFullScreen) {
          container.mozRequestFullScreen();
        } else if (container.msRequestFullscreen) {
          container.msRequestFullscreen();
        }
        
        // Mostrar panel DENTRO del contenedor fullscreen despu√©s de un delay
        setTimeout(() => {
          const fullscreenPanel = document.getElementById('queueMiniaturaFullscreen');
          if (fullscreenPanel) {
            fullscreenPanel.style.display = 'flex';
            renderQueueMiniaturaInFullscreen();
            console.log('‚úÖ Panel interno mostrado en fullscreen');
          }
        }, 500);
        
      } else {
        // Salir de fullscreen
        console.log('üé¨ Saliendo de fullscreen CUSTOM');
        
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
        
        // Ocultar panel
        const fullscreenPanel = document.getElementById('queueMiniaturaFullscreen');
        if (fullscreenPanel) {
          fullscreenPanel.style.display = 'none';
          console.log('‚úÖ Panel interno oculto');
        }
      }
    };

    // Renderizar panel que est√° DENTRO del fullscreen
    function renderQueueMiniaturaInFullscreen() {
      const container = document.getElementById('queueMiniaturaFullscreenContent');
      if (!container) return;

      if (!latestQueueSnapshot.length) {
        container.innerHTML = '<div class="mini-empty">No hay turnos activos</div>';
        return;
      }

      container.innerHTML = latestQueueSnapshot.map((snapshot) => renderMiniCard(snapshot, true)).join('');
    }

    function renderMiniCard(snapshot, fullscreen = false) {
      const className = fullscreen ? 'mini-barber-card fullscreen' : 'mini-barber-card';
      const queuePreview = snapshot.queuePreview || [];
      const currentLabel = snapshot.attendingCount > 0 ? 'Ocupado' : 'Libre';
      const queueCount = snapshot.waitingCount + (snapshot.groupedAppointments.upcoming?.length || 0);

      return `
        <div class="${className}">
          <div class="mini-barber-header">
            <div class="mini-barber-name-section">
              <span class="mini-barber-label">BARBERO</span>
              <p class="mini-barber-name">${sanitizeText(snapshot.barbero)}</p>
            </div>
          </div>

          <div class="mini-attending-section">
            <div class="mini-attending-header">
              <span class="mini-attending-label">EN SILLA</span>
              <span class="mini-attending-badge">${currentLabel}</span>
            </div>
            <p class="mini-attending-client">${sanitizeText(snapshot.currentClient)}</p>
          </div>

          <div class="mini-queue-section">
            <div class="mini-queue-header">
              <span class="mini-queue-label">EN COLA</span>
              <span class="mini-queue-badge">${queueCount} turno${queueCount === 1 ? '' : 's'}</span>
            </div>
            <div class="mini-chip-row">
              ${queuePreview.map((name) => `<div class="mini-chip ${name === 'Disponible' ? 'empty' : ''}">${sanitizeText(name)}</div>`).join('')}
            </div>
          </div>
        </div>
      `;
    }

    // Renderizar turnos en el panel miniatura
    function renderQueueMiniatura() {
      const container = document.getElementById('queueMiniaturaContent');
      if (!container) return;

      if (!latestQueueSnapshot.length) {
        container.innerHTML = '<div class="mini-empty">No hay turnos activos</div>';
        return;
      }

      const html = latestQueueSnapshot.map(renderMiniCard).join('');
      container.innerHTML = html;
    }

    // Renderizar video card
    function createVideoCard(video, showFavoriteBtn = true, isFavorite = false) {
      const thumbnail = video.thumbnail || `https://img.youtube.com/vi/${video.id}/mqdefault.jpg`;
      const escapedTitle = (video.title || '').replace(/'/g, "\\'");
      const escapedChannel = (video.channel || '').replace(/'/g, "\\'");
      
      return `
        <div class="video-card">
          <img src="${thumbnail}" alt="${sanitizeText(video.title)}" class="video-card-thumbnail" loading="lazy">
          <div class="video-card-info">
            <div class="video-card-title">${sanitizeText(video.title)}</div>
            <div class="video-card-channel">${sanitizeText(video.channel)}</div>
          </div>
          <div class="video-card-actions">
            <button class="video-card-btn" onclick="selectVideo('${video.id}', '${escapedTitle}', '${escapedChannel}')">
              ‚ñ∂Ô∏è Reproducir
            </button>
            ${showFavoriteBtn ? `
              <button class="video-card-btn" onclick="${isFavorite ? `removeFromFavorites('${video.id}')` : `addToFavorites('${video.id}', '${escapedTitle}', '${escapedChannel}')`}">
                ${isFavorite ? '‚ùå Quitar' : '‚≠ê Guardar'}
              </button>
            ` : ''}
          </div>
        </div>
      `;
    }

    // Renderizar videos de inicio
    function renderInicio() {
      const container = document.getElementById('videosInicio');
      if (videosSugeridos.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üéµ</div>
            <p>No hay videos sugeridos a√∫n</p>
          </div>
        `;
        return;
      }
      container.innerHTML = videosSugeridos.map(video => createVideoCard(video, true, false)).join('');
    }

    // Renderizar favoritos
    function renderFavoritos() {
      const container = document.getElementById('videosFavoritos');
      const favoritos = getFavoritos();
      
      if (favoritos.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚≠ê</div>
            <p>No tienes favoritos guardados</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Busca videos y agr√©galos a favoritos</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = favoritos.map(video => createVideoCard(video, true, true)).join('');
    }

    // Toggle Fullscreen de YouTube
    function toggleFullscreen() {
      const youtubeSection = document.getElementById('youtubeSection');
      const mainContent = document.getElementById('mainContent');
      const queueSection = document.getElementById('queueSection');
      const fullscreenText = document.getElementById('fullscreenText');
      
      isYoutubeFullscreen = !isYoutubeFullscreen;
      
      if (isYoutubeFullscreen) {
        youtubeSection.classList.add('fullscreen');
        youtubeSection.classList.remove('minimized');
        mainContent.classList.add('youtube-fullscreen');
        queueSection.classList.add('mini');
        queueSection.classList.remove('expanded');
        fullscreenText.textContent = '‚ó± Salir Pantalla Completa';
        isYoutubeMinimized = false;
      } else {
        youtubeSection.classList.remove('fullscreen');
        mainContent.classList.remove('youtube-fullscreen');
        queueSection.classList.remove('mini');
        fullscreenText.textContent = '‚õ∂ Pantalla Completa';
      }
    }

    // Toggle YouTube minimizado
    function toggleYoutube() {
      const youtubeSection = document.getElementById('youtubeSection');
      const mainContent = document.getElementById('mainContent');
      const queueSection = document.getElementById('queueSection');
      const toggleText = document.getElementById('toggleText');

      isYoutubeMinimized = !isYoutubeMinimized;

      if (isYoutubeMinimized) {
        youtubeSection.classList.add('minimized');
        youtubeSection.classList.remove('fullscreen');
        mainContent.classList.add('youtube-minimized');
        mainContent.classList.remove('youtube-fullscreen');
        queueSection.classList.add('expanded');
        queueSection.classList.remove('mini');
        toggleText.textContent = '‚¨ÜÔ∏è Maximizar';
        isYoutubeFullscreen = false;
      } else {
        youtubeSection.classList.remove('minimized');
        mainContent.classList.remove('youtube-minimized');
        queueSection.classList.remove('expanded');
        toggleText.textContent = 'Minimizar';
      }
    }

    // Actualizar hora y fecha
    function updateCurrentTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('es-ES', {
        hour: '2-digit',
        minute: '2-digit'
      });
      const dateString = now.toLocaleDateString('es-ES', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      const timeEl = document.getElementById('currentTime');
      const dateEl = document.getElementById('currentDate');

      if (timeEl) {
        timeEl.textContent = timeString;
      }

      if (dateEl) {
        dateEl.textContent = dateString;
      }
    }

    // Obtener color de estado
    function getStatusClass(status) {
      const statusMap = {
        'waiting': 'status-waiting',
        'confirmed': 'status-waiting',
        'in_chair': 'status-in_chair',
        'in_progress': 'status-in_progress'
      };
      return statusMap[status] || 'status-waiting';
    }

    // Obtener texto de estado
    function getStatusText(status) {
      const statusMap = {
        'waiting': 'En Cola',
        'confirmed': 'Confirmado',
        'in_chair': 'En Silla',
        'in_progress': 'Atendiendo'
      };
      return statusMap[status] || status;
    }

    // Cargar cola desde Supabase
    const COLOR_GRADIENTS = [
      'linear-gradient(135deg, rgba(236,72,153,0.18), rgba(79,70,229,0.12))',
      'linear-gradient(135deg, rgba(16,185,129,0.18), rgba(49,46,129,0.12))',
      'linear-gradient(135deg, rgba(249,115,22,0.18), rgba(109,40,217,0.12))',
      'linear-gradient(135deg, rgba(96,165,250,0.18), rgba(14,165,233,0.12))',
    ];

    const formatHour = (value) => {
      try {
        return new Date(value).toLocaleTimeString('es-CO', {
          hour: '2-digit',
          minute: '2-digit',
        });
      } catch (error) {
        return '--:--';
      }
    };

    const sortAppointments = (appointments) => {
      return [...appointments].sort((a, b) => {
        const priorityDiff = (STATUS_PRIORITY[a.status] ?? 99) - (STATUS_PRIORITY[b.status] ?? 99);
        if (priorityDiff !== 0) {
          return priorityDiff;
        }

        const timeA = new Date(a.fecha_hora).getTime();
        const timeB = new Date(b.fecha_hora).getTime();
        return timeA - timeB;
      });
    };

    const groupAppointments = (appointments) => {
      const grouped = {
        active: [],
        waiting: [],
        upcoming: [],
        rejected: [],
      };

      appointments.forEach((appointment) => {
        if (ACTIVE_STATES.has(appointment.status)) {
          grouped.active.push(appointment);
          return;
        }

        if (WAITING_STATES.has(appointment.status)) {
          grouped.waiting.push(appointment);
          return;
        }

        if (UPCOMING_STATES.has(appointment.status)) {
          grouped.upcoming.push(appointment);
          return;
        }

        if (REJECTED_STATES.has(appointment.status)) {
          grouped.rejected.push(appointment);
        }
      });

      grouped.active = sortAppointments(grouped.active);
      grouped.waiting = sortAppointments(grouped.waiting);
      grouped.upcoming = sortAppointments(grouped.upcoming);
      grouped.rejected = sortAppointments(grouped.rejected).slice(0, 3);

      return grouped;
    };

    const buildSnapshot = (barbero, groupedAppointments) => {
      const total = groupedAppointments.active.length + groupedAppointments.waiting.length + groupedAppointments.upcoming.length;
      const current = groupedAppointments.active[0] ?? null;

      const queuePreview = [...groupedAppointments.waiting, ...groupedAppointments.upcoming]
        .slice(0, 2)
        .map((appointment) => appointment.cliente_nombre ?? 'Cliente');

      while (queuePreview.length < 2) {
        queuePreview.push('Disponible');
      }

      return {
        id: barbero.id,
        barbero: `${barbero.nombre} ${barbero.apellido || ''}`.trim(),
        total,
        waitingCount: groupedAppointments.waiting.length,
        attendingCount: groupedAppointments.active.length,
        currentClient: current?.cliente_nombre ?? 'Disponible',
        groupedAppointments,
        queuePreview,
      };
    };

    const renderQueueCards = (snapshots) => {
      if (!snapshots.length) {
        return '<div class="no-queue">No hay turnos programados para hoy</div>';
      }

      return snapshots
        .map((snapshot) => {
          const currentLabel = snapshot.attendingCount > 0 ? 'Ocupado' : 'Libre';
          const queueCount = snapshot.waitingCount + (snapshot.groupedAppointments.upcoming?.length || 0);
          const queueChips = (snapshot.queuePreview ?? [])
            .map((name) => `
              <div class="queue-chip ${name === 'Disponible' ? 'empty' : ''}">
                ${sanitizeText(name)}
              </div>
            `)
            .join('');

          return `
            <article class="barber-card fade-in">
              <!-- Header del Barbero -->
              <div class="barber-header">
                <div class="barber-name-section">
                  <div class="barber-label">BARBERO</div>
                  <h3 class="barber-name">${sanitizeText(snapshot.barbero)}</h3>
                </div>
              </div>

              <!-- Secci√≥n En Silla (Verde) -->
              <div class="attending-section">
                <div class="attending-header">
                  <span class="attending-label">EN SILLA</span>
                  <span class="attending-badge">${currentLabel}</span>
                </div>
                <p class="attending-client">${sanitizeText(snapshot.currentClient)}</p>
              </div>

              <!-- Secci√≥n En Cola (Amarillo) -->
              <div class="queue-section-mini">
                <div class="queue-header">
                  <span class="queue-label">EN COLA</span>
                  <span class="queue-badge">${queueCount} turno${queueCount === 1 ? '' : 's'}</span>
                </div>
                <div class="queue-chips">
                  ${queueChips}
                </div>
              </div>
            </article>
          `;
        })
        .join('');
    };

    const fetchQueues = async () => {
      const startOfDay = new Date();
      startOfDay.setHours(0, 0, 0, 0);
      const endOfDay = new Date();
      endOfDay.setHours(23, 59, 59, 999);

      try {
        // Sincronizar con cola-virtual: obtener barberos y citas por separado
        const [barbersResult, appointmentsResult] = await Promise.all([
          supabaseClient
            .from('barberos')
            .select('id, nombre, apellido, especialidad, foto, activo')
            .eq('activo', true)
            .order('nombre', { ascending: true }),
          supabaseClient
            .from('citas')
            .select(`
              id, barbero_id, cliente_nombre, cliente_telefono, fecha_hora, status,
              servicios:servicios(nombre, duracion_minutos)
            `)
            .gte('fecha_hora', startOfDay.toISOString())
            .lt('fecha_hora', endOfDay.toISOString())
            .order('fecha_hora', { ascending: true }),
        ]);

        if (barbersResult.error) throw barbersResult.error;
        if (appointmentsResult.error) throw appointmentsResult.error;

        const activeBarbers = barbersResult.data ?? [];
        const groupedAppointments = new Map();
        const nowTs = Date.now();

        // Filtrar y agrupar citas por barbero
        for (const appointment of appointmentsResult.data ?? []) {
          const normalizedStatus = (appointment.status || 'scheduled').toLowerCase();
          
          // Filtrar estados igual que cola-virtual
          if (!ACTIVE_STATUSES.has(normalizedStatus) || BLOCKED_STATUSES.has(normalizedStatus)) {
            continue;
          }

          const servicioRaw = appointment.servicios;
          const servicioData = Array.isArray(servicioRaw) ? servicioRaw[0] : servicioRaw;

          const info = {
            id: appointment.id,
            cliente_nombre: appointment.cliente_nombre,
            status: normalizedStatus,
            fecha_hora: appointment.fecha_hora,
            servicio: {
              nombre: servicioData?.nombre ?? 'Servicio',
            },
          };

          const existing = groupedAppointments.get(appointment.barbero_id) ?? [];
          existing.push(info);
          groupedAppointments.set(appointment.barbero_id, existing);
        }

        // Construir snapshots igual que cola-virtual
        const snapshots = activeBarbers.map((barber) => {
          const appointmentsForBarber = groupedAppointments.get(barber.id) ?? [];
          appointmentsForBarber.sort((a, b) => new Date(a.fecha_hora).getTime() - new Date(b.fecha_hora).getTime());

          const active = [];
          const waiting = [];
          const upcoming = [];

          for (const appointment of appointmentsForBarber) {
            const appointmentTs = new Date(appointment.fecha_hora).getTime();
            const isCurrentlyInChair =
              appointment.status === 'in_progress' ||
              appointment.status === 'in_chair' ||
              (appointment.status === 'confirmed' && appointmentTs <= nowTs);

            if (isCurrentlyInChair) {
              active.push(appointment);
            } else if (appointment.status === 'waiting' || appointment.status === 'called') {
              waiting.push(appointment);
            } else {
              upcoming.push(appointment);
            }
          }

          const total = active.length + waiting.length + upcoming.length;
          const current = active[0] ?? null;
          const queuePreview = [...waiting, ...upcoming]
            .slice(0, 2)
            .map((appt) => appt.cliente_nombre ?? 'Cliente');

          while (queuePreview.length < 2) {
            queuePreview.push('Disponible');
          }

          return {
            id: barber.id,
            barbero: `${barber.nombre} ${barber.apellido || ''}`.trim(),
            total,
            waitingCount: waiting.length,
            attendingCount: active.length,
            currentClient: current?.cliente_nombre ?? 'Disponible',
            groupedAppointments: { active, waiting, upcoming },
            queuePreview,
          };
        }).filter((snapshot) => snapshot.total > 0);

        latestQueueSnapshot = snapshots;
        const queueList = document.getElementById('queueList');
        queueList.innerHTML = renderQueueCards(snapshots);

        renderQueueMiniatura();
        renderQueueMiniaturaInFullscreen();
      } catch (error) {
        console.error('Error al cargar cola:', error);
        showError('Error al cargar los turnos');
      }
    };

    // Mostrar error
    function showError(message) {
      const queueList = document.getElementById('queueList');
      queueList.innerHTML = `<div class="no-queue" style="color: #ef4444;">${message}</div>`;
    }

    // Inicializar
    async function init() {
      try {
        // Esperar a que Supabase est√© disponible
        await initSupabase();
        
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);

        fetchQueues();
        refreshInterval = setInterval(fetchQueues, 15000);

        // Cargar videos de inicio y favoritos
        renderInicio();
        renderFavoritos();

        // Configurar detecci√≥n de pantalla completa
        setupFullscreenDetection();

        // Configurar buscador de YouTube
        const searchInput = document.getElementById('youtubeSearchInput');
        if (searchInput) {
          searchInput.addEventListener('input', (e) => {
            // Debounce: esperar 500ms despu√©s de que el usuario deje de escribir
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
              searchYouTube(e.target.value);
            }, 500);
          });

          // Cerrar resultados al hacer click fuera
          document.addEventListener('click', (e) => {
            if (!e.target.closest('.youtube-search-container')) {
              document.getElementById('searchResults').classList.remove('show');
            }
          });
        }

        // Suscribirse a cambios en tiempo real
        if (supabaseClient) {
          const channel = supabaseClient
            .channel('turnos_changes')
            .on(
              'postgres_changes',
              { event: '*', schema: 'public', table: 'citas' },
              () => fetchQueues(),
            )
            .on(
              'postgres_changes',
              { event: '*', schema: 'public', table: 'daily_turns' },
              () => fetchQueues(),
            )
            .subscribe();
        }
      } catch (error) {
        console.error('‚ùå Error al inicializar:', error);
        showError('Error al conectar con el servidor');
      }
    }

    // Iniciar cuando cargue la p√°gina
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

    // Limpiar al salir
    window.addEventListener('beforeunload', () => {
      if (refreshInterval) {
        clearInterval(refreshInterval);
      }
    });
    // Sistema de modal personalizado para favoritos
    let modalCallback = null;

    function showModal(icon, title, message, type = 'info', onConfirm = null) {
      const modal = document.getElementById('favoritesModal');
      const modalIcon = document.getElementById('modalIcon');
      const modalTitle = document.getElementById('modalTitle');
      const modalMessage = document.getElementById('modalMessage');
      const modalButtons = document.getElementById('modalButtons');

      modalIcon.textContent = icon;
      modalTitle.textContent = title;
      modalMessage.textContent = message;
      modalCallback = onConfirm;

      // Configurar botones seg√∫n tipo de modal
      if (type === 'confirm') {
        modalButtons.innerHTML = `
          <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Cancelar</button>
          <button class="modal-btn modal-btn-confirm" onclick="confirmModal()">Aceptar</button>
        `;
      } else {
        modalButtons.innerHTML = `
          <button class="modal-btn modal-btn-confirm" onclick="closeModal()">Entendido</button>
        `;
      }

      modal.classList.add('show');
    }

    window.closeModal = function() {
      const modal = document.getElementById('favoritesModal');
      modal.classList.remove('show');
      modalCallback = null;
    };

    window.confirmModal = function() {
      if (modalCallback) {
        modalCallback();
      }
      closeModal();
    };

    // Cerrar modal al hacer click fuera
    document.addEventListener('click', (e) => {
      const modal = document.getElementById('favoritesModal');
      if (e.target === modal) {
        closeModal();
      }
    });

  </script>

  <!-- Modal de Favoritos -->
  <div id="favoritesModal" class="favorites-modal">
    <div class="modal-content">
      <div id="modalIcon" class="modal-icon"></div>
      <h2 id="modalTitle" class="modal-title"></h2>
      <p id="modalMessage" class="modal-message"></p>
      <div id="modalButtons" class="modal-buttons"></div>
    </div>
  </div>
</body>
</html>
